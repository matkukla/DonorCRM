---
phase: 04-grid-ui-core
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/package.json
  - frontend/package-lock.json
  - frontend/src/components/ui/tooltip.tsx
  - frontend/src/components/ui/badge.tsx
  - frontend/src/types/journals.ts
autonomous: true

must_haves:
  truths:
    - "Tooltip component renders accessible hover content"
    - "Badge has orange variant for 1-3 month freshness"
    - "TypeScript types exist for grid data structures"
  artifacts:
    - path: "frontend/src/components/ui/tooltip.tsx"
      provides: "Radix Tooltip component"
      exports: ["Tooltip", "TooltipTrigger", "TooltipContent", "TooltipProvider"]
    - path: "frontend/src/types/journals.ts"
      provides: "TypeScript interfaces for journal grid"
      exports: ["JournalMember", "StageEvent", "PipelineStage", "FreshnessColor"]
  key_links:
    - from: "frontend/src/components/ui/tooltip.tsx"
      to: "@radix-ui/react-tooltip"
      via: "npm dependency"
      pattern: "from.*@radix-ui/react-tooltip"
---

<objective>
Set up Phase 4 dependencies and foundational UI components.

Purpose: Phase 4 requires Radix Tooltip for hover states, date-fns for time calculations, and TypeScript types for grid data structures. This foundation enables all subsequent grid work.

Output: Installed npm packages, Tooltip component, Badge orange variant, TypeScript type definitions.
</objective>

<execution_context>
@/home/matkukla/.claude/get-shit-done/workflows/execute-plan.md
@/home/matkukla/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-grid-ui-core/04-RESEARCH.md

Reference existing components:
@frontend/src/components/ui/badge.tsx
@frontend/src/components/ui/sheet.tsx
@frontend/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install npm dependencies</name>
  <files>frontend/package.json, frontend/package-lock.json</files>
  <action>
Install @radix-ui/react-tooltip and date-fns:

```bash
cd frontend && npm install @radix-ui/react-tooltip date-fns
```

These are required by Phase 4 RESEARCH.md:
- @radix-ui/react-tooltip: Accessible tooltips for stage cell hover states
- date-fns: Relative time formatting ("3 days ago") and freshness calculations (differenceInDays)
  </action>
  <verify>Run `npm ls @radix-ui/react-tooltip date-fns` to confirm packages installed</verify>
  <done>Both packages appear in package.json dependencies and are installed in node_modules</done>
</task>

<task type="auto">
  <name>Task 2: Create Tooltip component</name>
  <files>frontend/src/components/ui/tooltip.tsx</files>
  <action>
Create Tooltip component following shadcn/ui pattern (from RESEARCH.md):

```typescript
import * as React from "react"
import * as TooltipPrimitive from "@radix-ui/react-tooltip"
import { cn } from "@/lib/utils"

const TooltipProvider = TooltipPrimitive.Provider

const Tooltip = TooltipPrimitive.Root

const TooltipTrigger = TooltipPrimitive.Trigger

const TooltipContent = React.forwardRef<
  React.ElementRef<typeof TooltipPrimitive.Content>,
  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>
>(({ className, sideOffset = 4, ...props }, ref) => (
  <TooltipPrimitive.Content
    ref={ref}
    sideOffset={sideOffset}
    className={cn(
      "z-50 overflow-hidden rounded-md bg-foreground px-3 py-1.5 text-xs text-background animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95",
      className
    )}
    {...props}
  />
))
TooltipContent.displayName = TooltipPrimitive.Content.displayName

export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }
```

Key aspects:
- Uses `asChild` pattern on TooltipTrigger for composability with click handlers
- z-50 ensures tooltip appears above sticky elements
- Matches existing animation patterns from sheet.tsx
  </action>
  <verify>TypeScript compiles without errors: `cd frontend && npx tsc --noEmit`</verify>
  <done>Tooltip exports all 4 components, uses @radix-ui/react-tooltip, matches shadcn pattern</done>
</task>

<task type="auto">
  <name>Task 3: Add orange Badge variant and create types</name>
  <files>frontend/src/components/ui/badge.tsx, frontend/src/types/journals.ts</files>
  <action>
**Part A: Update Badge with orange variant**

Add 'orange' variant to badge.tsx badgeVariants:
```typescript
orange:
  "border-transparent bg-orange-100 text-orange-800",
```

This is for the 1-3 month freshness indicator (per RESEARCH.md requirements).

**Part B: Create TypeScript types for journal grid**

Create `frontend/src/types/journals.ts`:

```typescript
/**
 * TypeScript types for Journal Grid UI.
 * Maps to Django models: Journal, JournalContact, JournalStageEvent, Decision
 */

/** Pipeline stages matching PipelineStage Django TextChoices */
export type PipelineStage =
  | 'contact'
  | 'meet'
  | 'close'
  | 'decision'
  | 'thank'
  | 'next_steps'

/** Stage event types matching StageEventType Django TextChoices */
export type StageEventType =
  | 'call_logged'
  | 'email_sent'
  | 'text_sent'
  | 'letter_sent'
  | 'meeting_scheduled'
  | 'meeting_completed'
  | 'ask_made'
  | 'follow_up_scheduled'
  | 'follow_up_completed'
  | 'decision_received'
  | 'thank_you_sent'
  | 'next_step_created'
  | 'note_added'
  | 'other'

/** Decision cadence options */
export type DecisionCadence = 'one_time' | 'monthly' | 'quarterly' | 'annual'

/** Decision status options */
export type DecisionStatus = 'pending' | 'active' | 'paused' | 'declined'

/** Freshness color based on days since last event */
export type FreshnessColor = 'success' | 'warning' | 'orange' | 'destructive' | 'secondary'

/** Journal list item from API */
export interface JournalListItem {
  id: string
  name: string
  goal_amount: string
  deadline: string | null
  is_archived: boolean
  created_at: string
  updated_at: string
}

/** Journal detail from API */
export interface JournalDetail extends JournalListItem {
  owner: string
  archived_at: string | null
}

/** Journal contact member with stage events summary */
export interface JournalMember {
  id: string
  journal: string
  contact: string
  contact_name: string
  contact_email: string | null
  contact_status: string
  created_at: string
  /** Stage events grouped by stage for grid display */
  stage_events: Record<PipelineStage, StageEventSummary>
  /** Current decision for this contact (if any) */
  decision: DecisionSummary | null
}

/** Summary of events for a single stage cell */
export interface StageEventSummary {
  has_events: boolean
  event_count: number
  last_event_date: string | null
  last_event_type: StageEventType | null
  last_event_notes: string | null
}

/** Stage event from API */
export interface StageEvent {
  id: string
  journal_contact: string
  stage: PipelineStage
  event_type: StageEventType
  notes: string
  metadata: Record<string, unknown>
  triggered_by: string | null
  created_at: string
}

/** Paginated stage events response */
export interface StageEventsPage {
  count: number
  next: string | null
  previous: string | null
  results: StageEvent[]
}

/** Decision summary for grid display */
export interface DecisionSummary {
  id: string
  amount: string
  cadence: DecisionCadence
  status: DecisionStatus
  monthly_equivalent: string
}

/** Props for freshness color calculation */
export function getFreshnessColor(lastEventDate: string | null): FreshnessColor {
  if (!lastEventDate) return 'secondary'

  const now = new Date()
  const eventDate = new Date(lastEventDate)
  const daysSince = Math.floor((now.getTime() - eventDate.getTime()) / (1000 * 60 * 60 * 24))

  if (daysSince < 7) return 'success'      // Green: <1 week
  if (daysSince < 30) return 'warning'     // Yellow/Amber: <1 month
  if (daysSince < 90) return 'orange'      // Orange: <3 months
  return 'destructive'                     // Red: 3+ months
}

/** Human-readable stage labels */
export const STAGE_LABELS: Record<PipelineStage, string> = {
  contact: 'Contact',
  meet: 'Meet',
  close: 'Close',
  decision: 'Decision',
  thank: 'Thank',
  next_steps: 'Next Steps',
}

/** Ordered list of stages for grid columns */
export const PIPELINE_STAGES: PipelineStage[] = [
  'contact',
  'meet',
  'close',
  'decision',
  'thank',
  'next_steps',
]
```

Key design decisions:
- Types match Django model field names exactly for API compatibility
- getFreshnessColor uses simple date math (not date-fns) for type file simplicity
- PIPELINE_STAGES constant provides ordered stages for grid column rendering
- JournalMember includes stage_events grouped by stage for efficient grid rendering
  </action>
  <verify>
1. TypeScript compiles: `cd frontend && npx tsc --noEmit`
2. Badge orange variant exists: grep "orange" frontend/src/components/ui/badge.tsx
  </verify>
  <done>
Badge has orange variant for 1-3 month freshness color.
TypeScript types file exports all journal grid interfaces: JournalMember, StageEvent, PipelineStage, FreshnessColor, getFreshnessColor, PIPELINE_STAGES.
  </done>
</task>

</tasks>

<verification>
1. npm packages installed: `cd frontend && npm ls @radix-ui/react-tooltip date-fns`
2. TypeScript compiles: `cd frontend && npx tsc --noEmit`
3. Tooltip component exists and exports 4 components
4. Badge has 8 variants (default, secondary, destructive, outline, success, warning, info, orange)
5. Types file exports JournalMember, StageEvent, PipelineStage, FreshnessColor, PIPELINE_STAGES
</verification>

<success_criteria>
- [ ] @radix-ui/react-tooltip and date-fns in package.json dependencies
- [ ] Tooltip component exports Tooltip, TooltipTrigger, TooltipContent, TooltipProvider
- [ ] Badge component has 'orange' variant with bg-orange-100 text-orange-800
- [ ] frontend/src/types/journals.ts exports all grid type definitions
- [ ] All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/04-grid-ui-core/04-01-SUMMARY.md`
</output>
