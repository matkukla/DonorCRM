---
phase: 06-reporting-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/tasks/models.py
  - apps/tasks/serializers.py
  - frontend/src/components/ui/chart.tsx
autonomous: true

must_haves:
  truths:
    - "Task model has optional journal ForeignKey (null=True, blank=True)"
    - "TaskSerializer includes journal_id field (read/write)"
    - "shadcn/ui Chart component installed and importable"
  artifacts:
    - path: "apps/tasks/models.py"
      provides: "Task.journal ForeignKey"
      contains: "journal = models.ForeignKey"
    - path: "frontend/src/components/ui/chart.tsx"
      provides: "ChartContainer, ChartConfig exports"
      contains: "ChartContainer"
  key_links:
    - from: "apps/tasks/models.py"
      to: "apps/journals/models.py"
      via: "ForeignKey relationship"
      pattern: "ForeignKey.*journals.Journal"
---

<objective>
Add Task.journal_id optional foreign key and install shadcn/ui Chart component.

Purpose: Enables journal-specific tasks (JRN-17) and provides chart primitives for Report tab (JRN-15).
Output: Task model extended with journal link, Chart component ready for use.
</objective>

<execution_context>
@/home/matkukla/.claude/get-shit-done/workflows/execute-plan.md
@/home/matkukla/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-reporting-integration/06-RESEARCH.md

@apps/tasks/models.py
@apps/tasks/serializers.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add journal ForeignKey to Task model</name>
  <files>apps/tasks/models.py</files>
  <action>
Add optional journal ForeignKey to Task model:

1. Add import: from apps.journals.models import Journal (or use string reference)
2. Add field after contact field:
```python
# Optional journal link (for journal-specific tasks)
journal = models.ForeignKey(
    'journals.Journal',
    on_delete=models.CASCADE,
    null=True,
    blank=True,
    related_name='tasks',
    help_text='Optional journal this task belongs to'
)
```

3. Add index for journal filtering - update Meta.indexes:
```python
indexes = [
    models.Index(fields=['owner', 'status', 'due_date']),
    models.Index(fields=['owner', 'due_date']),
    models.Index(fields=['contact', 'status']),
    models.Index(fields=['status', 'due_date']),
    models.Index(fields=['journal', 'status']),  # NEW
]
```

4. Generate and apply migration:
   - python manage.py makemigrations tasks --name add_journal_fk
   - python manage.py migrate

Per RESEARCH.md:
- null=True allows NULL in database
- blank=True allows empty in forms/serializers
- on_delete=CASCADE deletes tasks when journal deleted (appropriate - journal tasks are journal-specific)
- Use string 'journals.Journal' to avoid circular import
  </action>
  <verify>python manage.py showmigrations tasks shows new migration applied; Task.objects.filter(journal__isnull=True) executes without error</verify>
  <done>Task model has optional journal ForeignKey with proper index</done>
</task>

<task type="auto">
  <name>Task 2: Update TaskSerializer to include journal field</name>
  <files>apps/tasks/serializers.py</files>
  <action>
Update TaskSerializer to expose journal field:

1. Read current serializer structure
2. Add journal to Meta.fields list
3. Add journal_id as PrimaryKeyRelatedField for write operations:
```python
journal = serializers.PrimaryKeyRelatedField(
    queryset=Journal.objects.all(),
    required=False,
    allow_null=True
)
```

4. If using read_only fields, ensure journal is readable:
```python
journal_name = serializers.CharField(source='journal.name', read_only=True, allow_null=True)
```

5. Add validation to ensure journal belongs to same owner:
```python
def validate_journal(self, value):
    if value and value.owner != self.context['request'].user:
        raise serializers.ValidationError("Journal does not belong to you")
    return value
```

Import Journal model at top of file if not already imported.
  </action>
  <verify>POST /api/v1/tasks/ with journal field creates task linked to journal; GET returns journal_id and journal_name</verify>
  <done>TaskSerializer accepts and returns journal field with ownership validation</done>
</task>

<task type="auto">
  <name>Task 3: Install shadcn/ui Chart component</name>
  <files>frontend/src/components/ui/chart.tsx</files>
  <action>
Install shadcn/ui Chart component which wraps Recharts:

1. cd to frontend directory
2. Run: pnpm dlx shadcn@latest add chart
   - This installs recharts as dependency
   - Creates chart.tsx with ChartContainer, ChartConfig, ChartTooltip, etc.

3. Verify installation:
   - Check frontend/src/components/ui/chart.tsx exists
   - Check recharts in package.json dependencies
   - Run: pnpm build (ensure no TypeScript errors)

Per RESEARCH.md, the chart component provides:
- ChartContainer: Responsive wrapper with theme support
- ChartConfig: Type-safe color/label configuration
- ChartTooltip/ChartTooltipContent: Consistent tooltip styling
- CSS variables: --color-{key} for theming

The shadcn CLI handles all setup automatically.
  </action>
  <verify>cat frontend/src/components/ui/chart.tsx shows ChartContainer export; pnpm build succeeds</verify>
  <done>shadcn/ui Chart component installed with Recharts dependency</done>
</task>

</tasks>

<verification>
- [ ] Task model has journal ForeignKey (python manage.py shell: Task._meta.get_field('journal'))
- [ ] Migration applied successfully
- [ ] TaskSerializer includes journal in fields
- [ ] chart.tsx exists with ChartContainer, ChartConfig exports
- [ ] recharts in package.json dependencies
- [ ] pnpm build passes
</verification>

<success_criteria>
Task model extended with optional journal FK. TaskSerializer handles journal read/write with ownership validation. shadcn/ui Chart component ready for Report tab implementation.
</success_criteria>

<output>
After completion, create `.planning/phases/06-reporting-integration/06-02-SUMMARY.md`
</output>
