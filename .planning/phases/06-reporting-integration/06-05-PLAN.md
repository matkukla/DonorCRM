---
phase: 06-reporting-integration
plan: 05
type: execute
wave: 2
depends_on: ["06-02", "06-03"]
files_modified:
  - frontend/src/pages/contacts/ContactDetail.tsx
  - frontend/src/api/contacts.ts
  - frontend/src/hooks/useContacts.ts
autonomous: true

must_haves:
  truths:
    - "Contact Detail page has Journals tab in TabsList"
    - "Journals tab shows list of journals the contact belongs to"
    - "Each journal entry displays name, current stage, and decision status"
    - "Journals tab count reflects number of memberships"
  artifacts:
    - path: "frontend/src/pages/contacts/ContactDetail.tsx"
      provides: "Journals TabsTrigger and TabsContent"
      contains: "value=\"journals\""
    - path: "frontend/src/hooks/useContacts.ts"
      provides: "useContactJournals hook"
      contains: "useContactJournals"
  key_links:
    - from: "frontend/src/pages/contacts/ContactDetail.tsx"
      to: "/api/v1/contacts/{id}/journals/"
      via: "useContactJournals hook"
      pattern: "useContactJournals"
---

<objective>
Add Journals tab to Contact Detail page showing journal memberships.

Purpose: Implements JRN-16 Contact Detail Integration - user can see all journals a contact belongs to with stage and decision.
Output: Contact Detail page with functional Journals tab.
</objective>

<execution_context>
@/home/matkukla/.claude/get-shit-done/workflows/execute-plan.md
@/home/matkukla/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/06-reporting-integration/06-RESEARCH.md

@frontend/src/pages/contacts/ContactDetail.tsx
@frontend/src/api/contacts.ts
@frontend/src/hooks/useContacts.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add contact journals API and hook</name>
  <files>frontend/src/api/contacts.ts, frontend/src/hooks/useContacts.ts</files>
  <action>
Add API function and hook for contact journals:

1. In api/contacts.ts, add type and function:
```typescript
/** Journal membership for a contact */
export interface ContactJournalMembership {
  id: string
  journal_id: string
  journal_name: string
  goal_amount: string
  deadline: string | null
  current_stage: string
  decision: {
    id: string
    amount: string
    cadence: string
    status: string
  } | null
  created_at: string
}

/** Get journals a contact belongs to */
export async function getContactJournals(contactId: string): Promise<ContactJournalMembership[]> {
  const response = await apiClient.get<ContactJournalMembership[]>(
    `/contacts/${contactId}/journals/`
  )
  return response.data
}
```

2. In hooks/useContacts.ts, add hook:
```typescript
import { getContactJournals } from "@/api/contacts"
import type { ContactJournalMembership } from "@/api/contacts"

/** Hook for fetching contact's journal memberships */
export function useContactJournals(contactId: string) {
  return useQuery({
    queryKey: ['contacts', contactId, 'journals'],
    queryFn: () => getContactJournals(contactId),
    enabled: !!contactId,
  })
}
```

Export the hook from useContacts.ts.
  </action>
  <verify>TypeScript compiles; hook importable from @/hooks/useContacts</verify>
  <done>Contact journals API function and hook created</done>
</task>

<task type="auto">
  <name>Task 2: Add Journals tab to ContactDetail page</name>
  <files>frontend/src/pages/contacts/ContactDetail.tsx</files>
  <action>
Update ContactDetail.tsx to include Journals tab:

1. Add import:
```typescript
import { useContactJournals } from "@/hooks/useContacts"
import { BookOpen } from "lucide-react"  // or appropriate icon
```

2. Add hook call after other hooks:
```typescript
const { data: journals } = useContactJournals(id!)
```

3. Add TabsTrigger after Tasks tab:
```typescript
<TabsTrigger value="journals">
  Journals ({journals?.length || 0})
</TabsTrigger>
```

4. Add TabsContent before closing Tabs tag:
```typescript
<TabsContent value="journals" className="mt-6">
  <Card>
    <CardHeader className="flex flex-row items-center justify-between">
      <div>
        <CardTitle>Journal Memberships</CardTitle>
        <CardDescription>
          Journals this contact is currently enrolled in
        </CardDescription>
      </div>
    </CardHeader>
    <CardContent>
      {journals?.length ? (
        <div className="space-y-3">
          {journals.map((membership) => (
            <div
              key={membership.id}
              className="flex items-center justify-between py-3 border-b last:border-0"
            >
              <div className="space-y-1">
                <Link
                  to={`/journals/${membership.journal_id}`}
                  className="font-medium hover:underline"
                >
                  {membership.journal_name}
                </Link>
                <div className="flex items-center gap-2 text-sm text-muted-foreground">
                  <Badge variant="secondary">
                    {membership.current_stage.charAt(0).toUpperCase() + membership.current_stage.slice(1).replace('_', ' ')}
                  </Badge>
                  {membership.deadline && (
                    <span>Due: {formatDate(membership.deadline)}</span>
                  )}
                </div>
              </div>
              <div className="text-right">
                {membership.decision ? (
                  <div>
                    <p className="font-medium">
                      {formatCurrency(membership.decision.amount)}
                      <span className="text-muted-foreground font-normal">
                        /{membership.decision.cadence.replace('_', '-')}
                      </span>
                    </p>
                    <Badge
                      variant={
                        membership.decision.status === 'active' ? 'success' :
                        membership.decision.status === 'pending' ? 'warning' :
                        membership.decision.status === 'declined' ? 'destructive' :
                        'secondary'
                      }
                    >
                      {membership.decision.status}
                    </Badge>
                  </div>
                ) : (
                  <span className="text-muted-foreground">No decision</span>
                )}
              </div>
            </div>
          ))}
        </div>
      ) : (
        <p className="text-muted-foreground text-center py-8">
          This contact is not in any journals yet.
        </p>
      )}
    </CardContent>
  </Card>
</TabsContent>
```

The formatCurrency and formatDate functions already exist in ContactDetail.tsx.
  </action>
  <verify>pnpm build passes; Contact Detail page shows Journals tab</verify>
  <done>Journals tab added to Contact Detail with membership list</done>
</task>

</tasks>

<verification>
- [ ] ContactJournalMembership type exported from @/api/contacts
- [ ] getContactJournals function exported from @/api/contacts
- [ ] useContactJournals hook exported from @/hooks/useContacts
- [ ] ContactDetail.tsx has Journals TabsTrigger
- [ ] ContactDetail.tsx has Journals TabsContent
- [ ] Journals tab shows journal name, stage, decision
- [ ] Journal name links to journal detail page
- [ ] pnpm build passes
</verification>

<success_criteria>
Contact Detail page has functional Journals tab showing all journals the contact belongs to with current stage and decision status. Each journal name links to the journal detail page.
</success_criteria>

<output>
After completion, create `.planning/phases/06-reporting-integration/06-05-SUMMARY.md`
</output>
