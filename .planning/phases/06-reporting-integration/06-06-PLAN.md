---
phase: 06-reporting-integration
plan: 06
type: execute
wave: 3
depends_on: ["06-04", "06-05"]
files_modified:
  - frontend/src/pages/journals/JournalDetail.tsx
autonomous: false

must_haves:
  truths:
    - "User can view Report tab on Journal Detail page"
    - "Report tab displays all four analytics visualizations"
    - "Charts render with actual data from API"
    - "Contact Detail Journals tab shows real membership data"
    - "All success criteria from JRN-15 and JRN-16 verified"
  artifacts:
    - path: "frontend/src/pages/journals/JournalDetail.tsx"
      provides: "Report tab integration"
      contains: "ReportCharts"
  key_links:
    - from: "frontend/src/pages/journals/JournalDetail.tsx"
      to: "ReportCharts components"
      via: "import and render"
      pattern: "import.*ReportCharts"
---

<objective>
Integrate Report tab into Journal Detail page and verify all Phase 6 features.

Purpose: Final integration of JRN-15 Report Tab and human verification of all Phase 6 success criteria.
Output: Working Report tab with charts, verified Contact Journals tab, complete Phase 6.
</objective>

<execution_context>
@/home/matkukla/.claude/get-shit-done/workflows/execute-plan.md
@/home/matkukla/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md

@frontend/src/pages/journals/JournalDetail.tsx
@frontend/src/pages/journals/components/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Report tab to JournalDetail page</name>
  <files>frontend/src/pages/journals/JournalDetail.tsx</files>
  <action>
Add Report tab to JournalDetail page:

1. Check if JournalDetail already has Tabs. If not, wrap content in Tabs:

2. Add imports:
```typescript
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs"
import { DecisionTrendsChart, StageActivityChart, PipelineBreakdownChart, NextStepsQueue } from "./components"
```

3. If Tabs don't exist, restructure page:
   - Wrap JournalHeader and JournalGrid in TabsContent value="grid"
   - Add new TabsContent value="report" for charts

4. Add TabsList with triggers:
```typescript
<Tabs defaultValue="grid">
  <TabsList>
    <TabsTrigger value="grid">Pipeline Grid</TabsTrigger>
    <TabsTrigger value="report">Reports</TabsTrigger>
  </TabsList>

  <TabsContent value="grid" className="mt-6">
    <JournalHeader journal={journal} members={members?.results || []} />
    <JournalGrid journalId={id} members={members?.results || []} />
  </TabsContent>

  <TabsContent value="report" className="mt-6">
    <div className="grid gap-6 md:grid-cols-2">
      <DecisionTrendsChart />
      <PipelineBreakdownChart />
      <StageActivityChart />
      <NextStepsQueue />
    </div>
  </TabsContent>
</Tabs>
```

If JournalDetail already has a different layout, adapt accordingly - key is adding a Report tab/section that shows the four chart components.
  </action>
  <verify>pnpm build passes; Report tab visible on Journal Detail page</verify>
  <done>Report tab integrated into Journal Detail page with all four chart components</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 6 implementation:
1. Analytics API endpoints (decision trends, stage activity, pipeline breakdown, next steps queue, admin summary)
2. Task.journal_id optional foreign key for journal-specific tasks
3. Contact Detail Journals tab showing journal memberships
4. Journal Detail Report tab with bar, area, pie charts and next steps list
  </what-built>
  <how-to-verify>
**Pre-requisites:**
1. Start backend: `python manage.py runserver`
2. Start frontend: `pnpm dev`
3. Ensure you have test data (at least one journal with contacts, decisions, and stage events)

**JRN-15: Report Tab Analytics**
1. Navigate to any journal detail page
2. Click "Reports" tab
3. Verify Decision Trends chart (bar chart) shows monthly decision counts
4. Verify Pipeline Breakdown chart (pie chart) shows contacts by stage
5. Verify Stage Activity chart (area chart) shows events by stage over time
6. Verify Next Steps Queue shows upcoming actions with contact/journal names
7. If no data, verify empty state messages appear correctly

**JRN-16: Contact Detail Integration**
1. Navigate to any contact detail page
2. Verify "Journals" tab appears in tab list
3. Click Journals tab
4. Verify list shows all journals the contact belongs to
5. Verify each entry shows: journal name (clickable), current stage, decision (amount/cadence/status)
6. Click a journal name - should navigate to journal detail page

**JRN-19: Admin Analytics (if staff user)**
1. As staff user, test: `curl -H "Authorization: Token {token}" http://localhost:8000/api/v1/journals/analytics/admin-summary/`
2. Should return cross-missionary aggregation data
3. As non-staff user, same endpoint should return 403

**Performance Check:**
1. Open browser DevTools Network tab
2. Navigate to Report tab
3. Verify no excessive requests (should be 4-5 API calls for analytics)
4. Navigate to Contact Journals tab
5. Verify single API call for journals list

**Success criteria met:**
- [ ] Report tab shows decision trends chart (bar)
- [ ] Report tab shows stage activity chart (area)
- [ ] Report tab shows pipeline breakdown chart (pie)
- [ ] Report tab shows next steps queue (list)
- [ ] Contact detail has Journals tab
- [ ] Journals tab shows journal name, stage, decision for each membership
- [ ] Charts render without errors (check console)
- [ ] No N+1 visible in network (single request per data type)
  </how-to-verify>
  <resume-signal>Type "approved" if all features work correctly, or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
- [ ] Report tab visible on Journal Detail page
- [ ] All four chart components render
- [ ] Charts display data from API
- [ ] Contact Detail has Journals tab
- [ ] Journals tab shows memberships correctly
- [ ] Human verification approved
</verification>

<success_criteria>
Phase 6 complete with all JRN-15, JRN-16, and JRN-19 requirements implemented. User can view analytics in Report tab, see journal memberships on Contact Detail, and admin can access cross-missionary analytics.
</success_criteria>

<output>
After completion, create `.planning/phases/06-reporting-integration/06-06-SUMMARY.md`
</output>
