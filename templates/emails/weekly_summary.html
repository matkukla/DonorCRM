<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Summary</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px; }
        .header { background: #4f46e5; color: white; padding: 20px; border-radius: 8px 8px 0 0; }
        .content { background: #f9fafb; padding: 20px; border-radius: 0 0 8px 8px; }
        .section { background: white; padding: 15px; margin: 15px 0; border-radius: 6px; border-left: 4px solid #4f46e5; }
        .section h3 { margin: 0 0 10px 0; color: #4f46e5; }
        .alert { border-left-color: #ef4444; }
        .alert h3 { color: #ef4444; }
        .warning { border-left-color: #f59e0b; }
        .warning h3 { color: #f59e0b; }
        .success { border-left-color: #10b981; }
        .success h3 { color: #10b981; }
        .stat { display: inline-block; margin: 5px 10px 5px 0; padding: 5px 10px; background: #e0e7ff; border-radius: 4px; }
        .progress-bar { background: #e5e7eb; border-radius: 4px; height: 20px; overflow: hidden; }
        .progress-fill { background: #4f46e5; height: 100%; transition: width 0.3s; }
        .footer { text-align: center; margin-top: 20px; color: #6b7280; font-size: 14px; }
    </style>
</head>
<body>
    <div class="header">
        <h1 style="margin: 0;">Weekly Summary</h1>
        <p style="margin: 10px 0 0 0; opacity: 0.9;">Hello {{ user.first_name }}, here's what happened this week</p>
    </div>

    <div class="content">
        {% if what_changed.total_new > 0 %}
        <div class="section">
            <h3>What's New</h3>
            <p>You have <strong>{{ what_changed.total_new }}</strong> new notifications since your last visit.</p>
        </div>
        {% endif %}

        {% if needs_attention.late_pledge_count > 0 or needs_attention.overdue_task_count > 0 or needs_attention.tasks_due_today_count > 0 %}
        <div class="section alert">
            <h3>Needs Attention</h3>
            {% if needs_attention.late_pledge_count > 0 %}
            <span class="stat">{{ needs_attention.late_pledge_count }} late pledge(s)</span>
            {% endif %}
            {% if needs_attention.overdue_task_count > 0 %}
            <span class="stat">{{ needs_attention.overdue_task_count }} overdue task(s)</span>
            {% endif %}
            {% if needs_attention.tasks_due_today_count > 0 %}
            <span class="stat">{{ needs_attention.tasks_due_today_count }} task(s) due today</span>
            {% endif %}
        </div>
        {% endif %}

        {% if at_risk_count > 0 %}
        <div class="section warning">
            <h3>At-Risk Donors</h3>
            <p><strong>{{ at_risk_count }}</strong> donor(s) haven't given in 60+ days and may need follow-up.</p>
        </div>
        {% endif %}

        {% if thank_you_count > 0 %}
        <div class="section">
            <h3>Thank You Queue</h3>
            <p><strong>{{ thank_you_count }}</strong> contact(s) are waiting for thank-you acknowledgment.</p>
        </div>
        {% endif %}

        {% if support_progress %}
        <div class="section success">
            <h3>Support Progress</h3>
            <p>
                <strong>${{ support_progress.current_monthly_support|floatformat:2 }}</strong> of
                <strong>${{ support_progress.monthly_goal|floatformat:2 }}</strong> monthly goal
            </p>
            <div class="progress-bar">
                <div class="progress-fill" style="width: {{ support_progress.percentage|floatformat:0 }}%;"></div>
            </div>
            <p style="margin-top: 10px;">
                <strong>{{ support_progress.percentage|floatformat:0 }}%</strong> of goal
                {% if support_progress.gap > 0 %}
                &bull; ${{ support_progress.gap|floatformat:2 }} to go
                {% endif %}
            </p>
        </div>
        {% endif %}
    </div>

    <div class="footer">
        <p>Log in to DonorCRM to see full details and take action.</p>
        <p>&copy; DonorCRM</p>
    </div>
</body>
</html>
